<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Zabbix 邮件警告 | Nero Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="触发器邮件警告Zabbix 默认的邮箱警告有个 SMTP HELO 的值，我一直不知道怎么填写，反正这个值一直报错，网上爬文一堆都是通过脚本来发邮件的。 部署 sendEmail 环境 参考文献1：Zabbix通过stmp邮件报警 参考文献2：zabbix 3.0.2邮件报警  这里需要用到 sendEmail 下载地址，它是基于 perl 写的一个脚本，如果用 SSL 加密的话需要依赖 perl">
<meta name="keywords" content="Zabbix">
<meta property="og:type" content="article">
<meta property="og:title" content="Zabbix 邮件警告">
<meta property="og:url" content="http://hexo.neroxps.cn/2017/07/13/Zabbix-SMTP/index.html">
<meta property="og:site_name" content="Nero Blog">
<meta property="og:description" content="触发器邮件警告Zabbix 默认的邮箱警告有个 SMTP HELO 的值，我一直不知道怎么填写，反正这个值一直报错，网上爬文一堆都是通过脚本来发邮件的。 部署 sendEmail 环境 参考文献1：Zabbix通过stmp邮件报警 参考文献2：zabbix 3.0.2邮件报警  这里需要用到 sendEmail 下载地址，它是基于 perl 写的一个脚本，如果用 SSL 加密的话需要依赖 perl">
<meta property="og:image" content="http://hexo.neroxps.cn/2017/07/13/Zabbix-SMTP/file/Zabbix-SMTP/zabbix-01.png">
<meta property="og:image" content="http://hexo.neroxps.cn/2017/07/13/Zabbix-SMTP/file/Zabbix-SMTP/zabbix-02.png">
<meta property="og:image" content="http://hexo.neroxps.cn/2017/07/13/Zabbix-SMTP/file/Zabbix-SMTP/zabbix-03.png">
<meta property="og:image" content="http://hexo.neroxps.cn/2017/07/13/Zabbix-SMTP/file/Zabbix-SMTP/zabbix-04.png">
<meta property="og:image" content="http://hexo.neroxps.cn/2017/07/13/Zabbix-SMTP/file/Zabbix-SMTP/zabbix-05.png">
<meta property="og:image" content="http://hexo.neroxps.cn/2017/07/13/Zabbix-SMTP/file/Zabbix-SMTP/zabbix-06.png">
<meta property="og:image" content="http://hexo.neroxps.cn/2017/07/13/Zabbix-SMTP/file/Zabbix-SMTP/zabbix-07.png">
<meta property="og:image" content="http://hexo.neroxps.cn/2017/07/13/Zabbix-SMTP/file/Zabbix-SMTP/zabbix-08.png">
<meta property="og:image" content="http://hexo.neroxps.cn/2017/07/13/Zabbix-SMTP/file/Zabbix-SMTP/zabbix-09.png">
<meta property="og:image" content="http://hexo.neroxps.cn/2017/07/13/Zabbix-SMTP/file/Zabbix-SMTP/zabbix-10.png">
<meta property="og:updated_time" content="2017-07-17T09:40:56.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Zabbix 邮件警告">
<meta name="twitter:description" content="触发器邮件警告Zabbix 默认的邮箱警告有个 SMTP HELO 的值，我一直不知道怎么填写，反正这个值一直报错，网上爬文一堆都是通过脚本来发邮件的。 部署 sendEmail 环境 参考文献1：Zabbix通过stmp邮件报警 参考文献2：zabbix 3.0.2邮件报警  这里需要用到 sendEmail 下载地址，它是基于 perl 写的一个脚本，如果用 SSL 加密的话需要依赖 perl">
<meta name="twitter:image" content="http://hexo.neroxps.cn/2017/07/13/Zabbix-SMTP/file/Zabbix-SMTP/zabbix-01.png">
  
    <link rel="alternate" href="/atom.xml" title="Nero Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Nero Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://hexo.neroxps.cn"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Zabbix-SMTP" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/13/Zabbix-SMTP/" class="article-date">
  <time datetime="2017-07-12T16:00:00.000Z" itemprop="datePublished">2017-07-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/IT技术-Linux/">IT技术 Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Zabbix 邮件警告
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="触发器邮件警告"><a href="#触发器邮件警告" class="headerlink" title="触发器邮件警告"></a>触发器邮件警告</h1><p>Zabbix 默认的邮箱警告有个 SMTP HELO 的值，我一直不知道怎么填写，反正这个值一直报错，网上爬文一堆都是通过脚本来发邮件的。</p>
<h2 id="部署-sendEmail-环境"><a href="#部署-sendEmail-环境" class="headerlink" title="部署 sendEmail 环境"></a>部署 sendEmail 环境</h2><blockquote>
<p>参考文献1：<a href="http://www.jianshu.com/p/78ec2aba6824" target="_blank" rel="external">Zabbix通过stmp邮件报警</a></p>
<p>参考文献2：<a href="http://xiao987334176.blog.51cto.com/2202382/1768339" target="_blank" rel="external">zabbix 3.0.2邮件报警</a></p>
</blockquote>
<p>这里需要用到 sendEmail <a href="http://caspian.dotconf.net/menu/Software/SendEmail/" target="_blank" rel="external">下载地址</a>，它是基于 perl 写的一个脚本，如果用 SSL 加密的话需要依赖 perl 的 <strong>Net::SSLeay</strong> 和 <strong>IO::Socket::SSL</strong> 模块，debian 和 Ubuntu 的源都可以直接安装这个软件，另外安装 <code>libcrypt-ssleay-perl libio-socket-ssl-perl ca-certificates</code> 这三个包即可。</p>
<p>但是我查了下，zabbix/zabbix-server-mysql:latest 是使用 alpine 的，我测试的时候 sendEmail 官网下载的脚本会遇到 <code>invalid SSL_version</code> 的报错。Google 一番后据说要修改 <code>/usr/share/perl5/IO/Socket/SSL.pm</code> 这个依赖文件，但是我改了之后就会报 SSL 鉴定错误，故此不能这样做。</p>
<p>最终爬贴找到了这个帖子<strong><a href="https://sources.gentoo.org/cgi-bin/viewvc.cgi/gentoo-x86/net-mail/sendEmail/files/1.56-overzealous-version-check.patch?view=log" target="_blank" rel="external">1.56-overzealous-version-check.patch</a></strong></p>
<p>例子中是将 sendEmail 的 SSL_version 定义为 SSLv3，但是我使用的 QQ 邮箱和 Gmail 目前都在使用 TLSv1 协议，故此我需要将这个改成 TLSv1。</p>
<p>说回来我是 Docker 环境，故此我需要基于 zabbix/zabbix-server-mysql:latest 构建一个新的镜像。</p>
<h3 id="1-创建-Docker-构建文件夹"><a href="#1-创建-Docker-构建文件夹" class="headerlink" title="1. 创建 Docker 构建文件夹"></a>1. 创建 Docker 构建文件夹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkdir ~/zabbix-server-mysql-sendEmail</div></pre></td></tr></table></figure>
<h3 id="2-创建-Dockerfile"><a href="#2-创建-Dockerfile" class="headerlink" title="2. 创建 Dockerfile"></a>2. 创建 Dockerfile</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">cat &lt;&lt;EOF | tee ~/zabbix-server-mysql-sendEmail/Dockerfile</div><div class="line">FROM zabbix/zabbix-server-mysql</div><div class="line">RUN sed -i &apos;s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g&apos; /etc/apk/repositories &amp;&amp; \</div><div class="line">apk add --no-cache perl-crypt-ssleay perl-io-socket-ssl ca-certificates tzdata &amp;&amp; \</div><div class="line">wget http://caspian.dotconf.net/menu/Software/SendEmail/sendEmail-v1.56.tar.gz -P /tmp/ &amp;&amp; \</div><div class="line">tar xzf /tmp/sendEmail-v1.56.tar.gz -C /tmp/ &amp;&amp; \</div><div class="line">rm -f /tmp/sendEmail-v1.56.tar.gz &amp;&amp; \</div><div class="line">sed -i &quot;s/SSL_version =&gt; &apos;SSLv3 TLSv1&apos;/SSL_version =&gt; &apos;TLSv1&apos;/g&quot; /tmp/sendEmail-v1.56/sendEmail &amp;&amp; \</div><div class="line">mv /tmp/sendEmail-v1.56/sendEmail /usr/bin &amp;&amp; \</div><div class="line">chmod +x /usr/bin/sendEmail &amp;&amp; \</div><div class="line">rm -rf /tmp/* &amp;&amp; \</div><div class="line">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; \</div><div class="line">echo &quot;Asia/Shanghai&quot; &gt; /etc/timezone </div><div class="line"></div><div class="line">EXPOSE 10051/TCP 162/UDP</div><div class="line"></div><div class="line">WORKDIR /var/lib/zabbix</div><div class="line"></div><div class="line">ENTRYPOINT [&quot;/bin/bash&quot;]</div><div class="line"></div><div class="line">CMD [&quot;/run_zabbix_component.sh&quot;, &quot;server&quot;, &quot;mysql&quot;]</div><div class="line">EOF</div></pre></td></tr></table></figure>
<h3 id="3-构建镜像"><a href="#3-构建镜像" class="headerlink" title="3. 构建镜像"></a>3. 构建镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd ~/zabbix-server-mysql-sendEmail</div><div class="line">docker build -t nero/zabbix-server-mysql:latest .</div></pre></td></tr></table></figure>
<h3 id="4-停止官方使用的镜像，启用新镜像"><a href="#4-停止官方使用的镜像，启用新镜像" class="headerlink" title="4. 停止官方使用的镜像，启用新镜像"></a>4. 停止官方使用的镜像，启用新镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">docker rm -f zabbix-server #这里我之前启用镜像的时候使用的是别名</div><div class="line">docker run --name zabbix-server \</div><div class="line">--link zabbix-db:mysql-server \</div><div class="line">--restart=always \</div><div class="line">-e MYSQL_USER=zabbix \</div><div class="line">-e MYSQL_PASSWORD=zabbix \</div><div class="line">-e ZBX_IPMIPOLLERS=3 \</div><div class="line">-e ZBX_STARTVMWARECOLLECTORS=5 \</div><div class="line">-e ZBX_DEBUGLEVEL=3 \</div><div class="line">-v /home/nero/zabbix/externalscripts:/usr/lib/zabbix/externalscripts \</div><div class="line">-v /home/nero/zabbix/alertscripts:/usr/lib/zabbix/alertscripts \</div><div class="line">-p 10051:10051 \</div><div class="line">-d nero/zabbix-server-mysql</div></pre></td></tr></table></figure>
<h3 id="5-编写-sendEmail-的发信脚本"><a href="#5-编写-sendEmail-的发信脚本" class="headerlink" title="5. 编写 sendEmail 的发信脚本"></a>5. 编写 sendEmail 的发信脚本</h3><blockquote>
<p>参考自 <a href="http://www.jianshu.com/p/78ec2aba6824" target="_blank" rel="external">Zabbix通过stmp邮件报警</a></p>
</blockquote>
<p>我修改了下他的脚本，他脚本会自动转换字符编码，另外输出日志方便排查，但是日志不太详细，我给 sendEmail 加了 -v 参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">SMTP_server=&apos;smtp.qq.com:587&apos;    # SMTP服务器，我用 QQ TLS 的端口。</div><div class="line">username=&apos;email@email.com&apos;     # 用户名</div><div class="line">password=&apos; smtp_password&apos;             # 密码</div><div class="line">from_email_address=&apos;email@email.com&apos; # 发件人Email地址</div><div class="line">to_email_address=&quot;$1&quot;               # 收件人Email地址，zabbix传入的第一个参数</div><div class="line">message_subject_utf8=&quot;$2&quot;           # 邮件标题，zabbix传入的第二个参数</div><div class="line">message_body_utf8=&quot;$3&quot;              # 邮件内容，zabbix传入的第三个参数</div><div class="line"></div><div class="line">echo &quot;`date +&quot;%F %T&quot;` send to $to_email_address&quot; &gt;&gt; /tmp/send.log</div><div class="line"></div><div class="line"># 转换邮件标题为GB2312，解决邮件标题含有中文，收到邮件显示乱码的问题。</div><div class="line">message_subject_gb2312=`iconv -t GB2312 -f UTF-8 &lt;&lt; EOF</div><div class="line">$message_subject_utf8</div><div class="line">EOF`</div><div class="line">[ $? -eq 0 ] &amp;&amp; message_subject=&quot;$message_subject_gb2312&quot; || message_subject=&quot;$message_subject_utf8&quot;</div><div class="line">bhnaqekboudsdcca</div><div class="line"># 转换邮件内容为GB2312</div><div class="line">message_body_gb2312=`iconv -t GB2312 -f UTF-8 &lt;&lt; EOF</div><div class="line">$message_body_utf8</div><div class="line">EOF`</div><div class="line">[ $? -eq 0 ] &amp;&amp; message_body=&quot;$message_body_gb2312&quot; || message_body=&quot;$message_body_utf8&quot;</div><div class="line"></div><div class="line"># 发送邮件</div><div class="line">sendEmail=&apos;/usr/bin/sendEmail&apos;</div><div class="line">$sendEmail -s &quot;$SMTP_server&quot; -xu &quot;$username&quot; -xp &quot;$password&quot; -f &quot;$from_email_address&quot; -t &quot;$to_email_address&quot; -u &quot;$message_subject&quot; -m &quot;$message_body&quot; -o message-content-type=text -o message-charset=gb2312 -o tls=yes -v &gt;&gt; /tmp/send.log</div><div class="line"></div><div class="line">echo $? &gt;&gt; /tmp/send.log</div><div class="line">echo &quot;zabbix 参数1 = $1&quot; &gt;&gt; /tmp/send.log</div><div class="line">echo &quot;zabbix 参数2 = $2&quot; &gt;&gt; /tmp/send.log</div><div class="line">echo &quot;zabbix 参数3 = $3&quot; &gt;&gt; /tmp/send.log</div><div class="line">echo &gt;&gt; /tmp/send.log</div><div class="line">echo &gt;&gt; /tmp/send.log</div><div class="line">echo &gt;&gt; /tmp/send.log</div></pre></td></tr></table></figure>
<h2 id="Zabbix-设置邮件告警"><a href="#Zabbix-设置邮件告警" class="headerlink" title="Zabbix 设置邮件告警"></a>Zabbix 设置邮件告警</h2><blockquote>
<p>我这里的 Zabbix 版本是3.2版本，不同版本界面略有不同，据说2.0的版本不需要加脚本参数，3.0开始需要加脚本参数了。</p>
</blockquote>
<h3 id="1-创建报价媒介类型"><a href="#1-创建报价媒介类型" class="headerlink" title="1. 创建报价媒介类型"></a>1. 创建报价媒介类型</h3><p><img src="/2017/07/13/Zabbix-SMTP/file/Zabbix-SMTP/zabbix-01.png" alt="zabbix-01"></p>
<h3 id="2-输入报警媒介类型参数"><a href="#2-输入报警媒介类型参数" class="headerlink" title="2. 输入报警媒介类型参数"></a>2. 输入报警媒介类型参数</h3><p><img src="/2017/07/13/Zabbix-SMTP/file/Zabbix-SMTP/zabbix-02.png" alt="zabbix-02"></p>
<p>这里注意，脚本参数顺序不要错，否则会导致发信失败。</p>
<table>
<thead>
<tr>
<th>脚本参数</th>
<th>参数</th>
<th>注释</th>
</tr>
</thead>
<tbody>
<tr>
<td>第一个参数</td>
<td>{ALERT.SENDTO}</td>
<td>目的邮箱地址</td>
</tr>
<tr>
<td>第二个参数</td>
<td>{ALERT.SUBJECT}</td>
<td>邮件主题</td>
</tr>
<tr>
<td>第三个参数</td>
<td>{ALERT.MESSAGE}</td>
<td>邮件内容</td>
</tr>
</tbody>
</table>
<h3 id="3-配置用户收信邮箱"><a href="#3-配置用户收信邮箱" class="headerlink" title="3. 配置用户收信邮箱"></a>3. 配置用户收信邮箱</h3><p><img src="/2017/07/13/Zabbix-SMTP/file/Zabbix-SMTP/zabbix-03.png" alt="zabbix-03"></p>
<hr>
<p><img src="/2017/07/13/Zabbix-SMTP/file/Zabbix-SMTP/zabbix-04.png" alt="zabbix-04"></p>
<hr>
<p><img src="/2017/07/13/Zabbix-SMTP/file/Zabbix-SMTP/zabbix-05.png" alt="zabbix-05"></p>
<hr>
<p><img src="/2017/07/13/Zabbix-SMTP/file/Zabbix-SMTP/zabbix-06.png" alt="zabbix-06"></p>
<h3 id="4-配置动作"><a href="#4-配置动作" class="headerlink" title="4. 配置动作"></a>4. 配置动作</h3><p>这里我建立一个触发器警告，当触发器条件为真的时候，就发出警告邮件。</p>
<p><img src="/2017/07/13/Zabbix-SMTP/file/Zabbix-SMTP/zabbix-07.png" alt="zabbix-07"></p>
<p><strong>注意这里事件源选择触发器</strong></p>
<hr>
<p>按图片重复添加动作条件</p>
<p><img src="/2017/07/13/Zabbix-SMTP/file/Zabbix-SMTP/zabbix-08.png" alt="zabbix-08"></p>
<hr>
<p><img src="/2017/07/13/Zabbix-SMTP/file/Zabbix-SMTP/zabbix-09.png" alt="zabbix-09"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">默认接收人：『服务器警报』 &#123;HOST.NAME&#125;:&#123;ITEM.NAME&#125;</div><div class="line"></div><div class="line">默认信息：</div><div class="line">告警主机: &#123;HOSTNAME1&#125;</div><div class="line">告警时间: &#123;EVENT.DATE&#125; &#123;EVENT.TIME&#125;</div><div class="line">告警等级: &#123;TRIGGER.SEVERITY&#125;</div><div class="line">告警信息: &#123;TRIGGER.NAME&#125;</div><div class="line">告警项目: &#123;TRIGGER.KEY1&#125;</div><div class="line">问题详情: &#123;ITEM.NAME&#125;: &#123;ITEM.VALUE&#125;</div><div class="line">当前状态: &#123;TRIGGER.STATUS&#125;: &#123;ITEM.VALUE1&#125;</div><div class="line">事件ID: &#123;EVENT.ID&#125;</div></pre></td></tr></table></figure>
<p>其余参数按照图片设置，目前还没理解透这里所有选项，这里就不班门弄斧。</p>
<hr>
<p><img src="/2017/07/13/Zabbix-SMTP/file/Zabbix-SMTP/zabbix-10.png" alt="zabbix-10"></p>
<p>这里是触发器值为假后的操作，你可以自定义恢复公式，也可以按照原来的公式为假后发送邮件，告诉我们这个监控值正常了。</p>
<p>里面的内容除了<strong>默认接收人</strong>也就是邮件标题外，其余内容和上面的一样。</p>
<h4 id="调试邮件告警"><a href="#调试邮件告警" class="headerlink" title="调试邮件告警"></a>调试邮件告警</h4><p>监控邮件发送日志，就可以调试邮件的发送状态了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">docker exec -it zabbix-server tail -f /tmp/send.log</div><div class="line">2017-07-12 17:53:07 send to neroxps@gmail.com</div><div class="line">Jul 12 17:53:07 1890ce4a57bf sendEmail[172]: DEBUG =&gt; Connecting to smtp.qq.com:587</div><div class="line">Jul 12 17:53:07 1890ce4a57bf sendEmail[172]: DEBUG =&gt; My IP address is: 172.17.0.3</div><div class="line">Jul 12 17:53:07 1890ce4a57bf sendEmail[172]: SUCCESS =&gt; Received:       220 smtp.qq.com Esmtp QQ Mail Server</div><div class="line">Jul 12 17:53:07 1890ce4a57bf sendEmail[172]: INFO =&gt; Sending:   EHLO </div><div class="line">Jul 12 17:53:07 1890ce4a57bf sendEmail[172]: SUCCESS =&gt; Received:       250-smtp.qq.com, 250-PIPELINING, 250-SIZE 73400320, 250-STARTTLS, 250-AUTH LOGIN PLAIN, 250-AUTH=LOGIN, 250-MAILCOMPRESS, 250 8BITMIME</div><div class="line">Jul 12 17:53:07 1890ce4a57bf sendEmail[172]: INFO =&gt; Sending:   STARTTLS</div><div class="line">Jul 12 17:53:07 1890ce4a57bf sendEmail[172]: SUCCESS =&gt; Received:       220 Ready to start TLS</div><div class="line">Jul 12 17:53:07 1890ce4a57bf sendEmail[172]: DEBUG =&gt; TLS session initialized :)</div><div class="line">Jul 12 17:53:07 1890ce4a57bf sendEmail[172]: INFO =&gt; Sending:   EHLO </div><div class="line">Jul 12 17:53:07 1890ce4a57bf sendEmail[172]: SUCCESS =&gt; Received:       250-smtp.qq.com, 250-PIPELINING, 250-SIZE 73400320, 250-AUTH LOGIN PLAIN, 250-AUTH=LOGIN, 250-MAILCOMPRESS, 250 8BITMIME</div><div class="line">Jul 12 17:53:07 1890ce4a57bf sendEmail[172]: DEBUG =&gt; SMTP-AUTH: Using LOGIN authentication method</div><div class="line">Jul 12 17:53:07 1890ce4a57bf sendEmail[172]: INFO =&gt; Sending:   AUTH LOGIN</div><div class="line">Jul 12 17:53:07 1890ce4a57bf sendEmail[172]: SUCCESS =&gt; Received:       334 VXNlcm5hbWU6</div><div class="line">Jul 12 17:53:07 1890ce4a57bf sendEmail[172]: INFO =&gt; Sending:   </div><div class="line">Jul 12 17:53:07 1890ce4a57bf sendEmail[172]: SUCCESS =&gt; Received:       334 UGFzc3dvcmQ6</div><div class="line">Jul 12 17:53:07 1890ce4a57bf sendEmail[172]: INFO =&gt; Sending:   </div><div class="line">Jul 12 17:53:08 1890ce4a57bf sendEmail[172]: SUCCESS =&gt; Received:       235 Authentication successful</div><div class="line">Jul 12 17:53:08 1890ce4a57bf sendEmail[172]: DEBUG =&gt; User authentication was successful (Method: LOGIN)</div><div class="line">Jul 12 17:53:08 1890ce4a57bf sendEmail[172]: INFO =&gt; Sending:   MAIL FROM:&lt;email@email.com&gt;</div><div class="line">Jul 12 17:53:08 1890ce4a57bf sendEmail[172]: SUCCESS =&gt; Received:       250 Ok</div><div class="line">Jul 12 17:53:08 1890ce4a57bf sendEmail[172]: INFO =&gt; Sending:   RCPT TO:&lt;neroxps@gmail.com&gt;</div><div class="line">Jul 12 17:53:08 1890ce4a57bf sendEmail[172]: SUCCESS =&gt; Received:       250 Ok</div><div class="line">Jul 12 17:53:08 1890ce4a57bf sendEmail[172]: INFO =&gt; Sending:   DATA</div><div class="line">Jul 12 17:53:08 1890ce4a57bf sendEmail[172]: SUCCESS =&gt; Received:       354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;</div><div class="line">Jul 12 17:53:08 1890ce4a57bf sendEmail[172]: INFO =&gt; Sending message body</div><div class="line">Jul 12 17:53:08 1890ce4a57bf sendEmail[172]: Setting content-type: text/plain</div><div class="line">Jul 12 17:53:08 1890ce4a57bf sendEmail[172]: SUCCESS =&gt; Received:       250 Ok: queued as</div><div class="line">Jul 12 17:53:08 1890ce4a57bf sendEmail[172]: Email was sent successfully!  From: &lt;email@email.com&gt; To: &lt;neroxps@gmail.com&gt; Subject: [『服务器警报恢复』 Gen8-ipmi:02-CPU] Server: [smtp.qq.com:587]</div><div class="line">0</div><div class="line">zabbix 参数1 = neroxps@gmail.com</div><div class="line">zabbix 参数2 = 『服务器警报恢复』 Gen8-ipmi:02-CPU</div><div class="line">zabbix 参数3 = 告警主机: Gen8-ipmi</div><div class="line">告警时间: 2017.07.12 17:50:58</div><div class="line">告警等级: High</div><div class="line">告警信息: Gen8-ipmi CPU温度过高-test006</div><div class="line">告警项目: 02-CPU</div><div class="line">问题详情: 02-CPU: 40 ℃</div><div class="line">当前状态: OK: 40 ℃</div><div class="line">事件ID: 4858</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://hexo.neroxps.cn/2017/07/13/Zabbix-SMTP/" data-id="cj57yn7ov000udnqjv2rh41j8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Zabbix/">Zabbix</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/07/15/Zabbix-agent-installation-Debian/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          zabbix-agent 安装及升级
        
      </div>
    </a>
  
  
    <a href="/2017/07/01/Zabbix-Installation-Docker/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">使用 Docker 部署 Zabbix 3.2 记录</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Blog/">Blog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/GitBlog/">GitBlog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/IT技术/">IT技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/IT技术-Linux/">IT技术 Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Seafile/">Seafile</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Seafile-IT技术/">Seafile,IT技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/test/">test</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/日记/">日记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络/">网络</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/饮食/">饮食</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/黑苹果/">黑苹果</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Blog/">Blog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ERP-Linux-GoodERP-Odoo/">ERP,Linux,GoodERP,Odoo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GitBlog/">GitBlog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenWRT-shadowsocks-shadowsocks-R-免流/">OpenWRT,shadowsocks,shadowsocks-R,免流</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Seafile-Pro/">Seafile Pro</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Seafile-Gitblog-seaf-cli/">Seafile,Gitblog,seaf-cli</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Seafile-Mysql/">Seafile,Mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Zabbix/">Zabbix</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx-http2-https-安全/">nginx,http2.https,安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/seafile-onlyoffice/">seafile,onlyoffice</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shadowsocksR/">shadowsocksR</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/test/">test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/日记/">日记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/重庆火锅/">重庆火锅</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/锐捷-TP-Link-无线/">锐捷,TP-Link,无线</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/黑苹果-Mac-Hackintosh/">黑苹果,Mac,Hackintosh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/黑苹果-Mac-Hackintosh-ASUS-ACPI/">黑苹果,Mac,Hackintosh,ASUS, ACPI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/黑苹果-Mac-Hackintosh-ASUS-VM510LI/">黑苹果,Mac,Hackintosh,ASUS,VM510LI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/黑苹果-Mac-Hackintosh-ASUS-VM510LI-ALC233/">黑苹果,Mac,Hackintosh,ASUS,VM510LI,ALC233</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/黑苹果-Mac-Hackintosh-ASUS-VM510LI-BCM94252HMB/">黑苹果,Mac,Hackintosh,ASUS,VM510LI,BCM94252HMB</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Blog/" style="font-size: 10px;">Blog</a> <a href="/tags/ERP-Linux-GoodERP-Odoo/" style="font-size: 10px;">ERP,Linux,GoodERP,Odoo</a> <a href="/tags/GitBlog/" style="font-size: 10px;">GitBlog</a> <a href="/tags/OpenWRT-shadowsocks-shadowsocks-R-免流/" style="font-size: 10px;">OpenWRT,shadowsocks,shadowsocks-R,免流</a> <a href="/tags/Seafile-Pro/" style="font-size: 10px;">Seafile Pro</a> <a href="/tags/Seafile-Gitblog-seaf-cli/" style="font-size: 10px;">Seafile,Gitblog,seaf-cli</a> <a href="/tags/Seafile-Mysql/" style="font-size: 10px;">Seafile,Mysql</a> <a href="/tags/Zabbix/" style="font-size: 16.67px;">Zabbix</a> <a href="/tags/nginx-http2-https-安全/" style="font-size: 10px;">nginx,http2.https,安全</a> <a href="/tags/seafile-onlyoffice/" style="font-size: 10px;">seafile,onlyoffice</a> <a href="/tags/shadowsocksR/" style="font-size: 10px;">shadowsocksR</a> <a href="/tags/test/" style="font-size: 13.33px;">test</a> <a href="/tags/日记/" style="font-size: 13.33px;">日记</a> <a href="/tags/重庆火锅/" style="font-size: 10px;">重庆火锅</a> <a href="/tags/锐捷-TP-Link-无线/" style="font-size: 10px;">锐捷,TP-Link,无线</a> <a href="/tags/黑苹果-Mac-Hackintosh/" style="font-size: 10px;">黑苹果,Mac,Hackintosh</a> <a href="/tags/黑苹果-Mac-Hackintosh-ASUS-ACPI/" style="font-size: 10px;">黑苹果,Mac,Hackintosh,ASUS, ACPI</a> <a href="/tags/黑苹果-Mac-Hackintosh-ASUS-VM510LI/" style="font-size: 20px;">黑苹果,Mac,Hackintosh,ASUS,VM510LI</a> <a href="/tags/黑苹果-Mac-Hackintosh-ASUS-VM510LI-ALC233/" style="font-size: 10px;">黑苹果,Mac,Hackintosh,ASUS,VM510LI,ALC233</a> <a href="/tags/黑苹果-Mac-Hackintosh-ASUS-VM510LI-BCM94252HMB/" style="font-size: 10px;">黑苹果,Mac,Hackintosh,ASUS,VM510LI,BCM94252HMB</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/07/17/images-test/">images-test</a>
          </li>
        
          <li>
            <a href="/2017/07/17/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2017/07/15/Zabbix-agent-installation-Debian/">zabbix-agent 安装及升级</a>
          </li>
        
          <li>
            <a href="/2017/07/13/Zabbix-SMTP/">Zabbix 邮件警告</a>
          </li>
        
          <li>
            <a href="/2017/07/01/Zabbix-Installation-Docker/">使用 Docker 部署 Zabbix 3.2 记录</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Nero Hau<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>