<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.proxy.ustclug.org/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="黑苹果,Mac,Hackintosh,dsdt," />





  <link rel="alternate" href="/atom.xml" title="Nero Blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="本文说明本文转载至远景论坛 daxuexinsheng 的帖子 [教程] [授权翻译] 使用补丁修改DSDT/SSDT [DSDT/SSDT综合教程] 近期远景论坛访问异常，还需要改 hosts 才能正常访问，而远景几乎是国内比较大的黑苹果权威论坛，为了防止一些珍贵的文献无法访问，而又方便日后翻查，我决定转载一些有用的文章。  [toc] 翻译授权信息  本教程原作者是tonymacx86网站的">
<meta name="keywords" content="黑苹果,Mac,Hackintosh,dsdt">
<meta property="og:type" content="article">
<meta property="og:title" content="【转载】【教程】 【授权翻译】 使用补丁修改DSDT&#x2F;SSDT 【DSDT&#x2F;SSDT综合教程】">
<meta property="og:url" content="http://hexo.neroxps.cn/2017/01/16/extract_edit_dsdt/index.html">
<meta property="og:site_name" content="Nero Blog">
<meta property="og:description" content="本文说明本文转载至远景论坛 daxuexinsheng 的帖子 [教程] [授权翻译] 使用补丁修改DSDT/SSDT [DSDT/SSDT综合教程] 近期远景论坛访问异常，还需要改 hosts 才能正常访问，而远景几乎是国内比较大的黑苹果权威论坛，为了防止一些珍贵的文献无法访问，而又方便日后翻查，我决定转载一些有用的文章。  [toc] 翻译授权信息  本教程原作者是tonymacx86网站的">
<meta property="og:image" content="http://hexo.neroxps.cn/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-01.png">
<meta property="og:image" content="http://hexo.neroxps.cn/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-02.jpg">
<meta property="og:image" content="http://hexo.neroxps.cn/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-03.jpg">
<meta property="og:image" content="http://hexo.neroxps.cn/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-04.jpg">
<meta property="og:image" content="http://hexo.neroxps.cn/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-05.png">
<meta property="og:image" content="http://hexo.neroxps.cn/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-06.png">
<meta property="og:image" content="http://hexo.neroxps.cn/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-07.png">
<meta property="og:image" content="http://hexo.neroxps.cn/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-08.png">
<meta property="og:image" content="http://hexo.neroxps.cn/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-09.png">
<meta property="og:image" content="http://hexo.neroxps.cn/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-10.png">
<meta property="og:image" content="http://hexo.neroxps.cn/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-11.png">
<meta property="og:image" content="http://hexo.neroxps.cn/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-12.png">
<meta property="og:updated_time" content="2017-07-20T00:40:44.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="【转载】【教程】 【授权翻译】 使用补丁修改DSDT&#x2F;SSDT 【DSDT&#x2F;SSDT综合教程】">
<meta name="twitter:description" content="本文说明本文转载至远景论坛 daxuexinsheng 的帖子 [教程] [授权翻译] 使用补丁修改DSDT/SSDT [DSDT/SSDT综合教程] 近期远景论坛访问异常，还需要改 hosts 才能正常访问，而远景几乎是国内比较大的黑苹果权威论坛，为了防止一些珍贵的文献无法访问，而又方便日后翻查，我决定转载一些有用的文章。  [toc] 翻译授权信息  本教程原作者是tonymacx86网站的">
<meta name="twitter:image" content="http://hexo.neroxps.cn/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-01.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://hexo.neroxps.cn/2017/01/16/extract_edit_dsdt/"/>





  <title>【转载】【教程】 【授权翻译】 使用补丁修改DSDT/SSDT 【DSDT/SSDT综合教程】 | Nero Blog</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?6990360e021ae3bf2debc80fd3be44dd";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Nero Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://hexo.neroxps.cn/2017/01/16/extract_edit_dsdt/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nero Hau">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nero Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">【转载】【教程】 【授权翻译】 使用补丁修改DSDT/SSDT 【DSDT/SSDT综合教程】</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-16T00:00:00+08:00">
                2017-01-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/黑苹果/" itemprop="url" rel="index">
                    <span itemprop="name">黑苹果</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/01/16/extract_edit_dsdt/" class="leancloud_visitors" data-flag-title="【转载】【教程】 【授权翻译】 使用补丁修改DSDT/SSDT 【DSDT/SSDT综合教程】">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<h2 id="本文说明"><a href="#本文说明" class="headerlink" title="本文说明"></a>本文说明</h2><p>本文转载至远景论坛 daxuexinsheng 的帖子 <a href="http://bbs.pcbeta.com/viewthread-1571455-1-1.html" target="_blank" rel="external">[教程] [授权翻译] 使用补丁修改DSDT/SSDT [DSDT/SSDT综合教程]</a></p>
<p>近期远景论坛访问异常，还需要改 hosts 才能正常访问，而远景几乎是国内比较大的黑苹果权威论坛，为了防止一些珍贵的文献无法访问，而又方便日后翻查，我决定转载一些有用的文章。</p>
</blockquote>
<p>[toc]</p>
<h2 id="翻译授权信息"><a href="#翻译授权信息" class="headerlink" title="翻译授权信息"></a>翻译授权信息</h2><p>  本教程原作者是tonymacx86网站的Rehabman。本贴，是对原贴的 翻译 与 补充。已经得到Rehabman的授权。相关信息如下：</p>
<p><img src="/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-01.png" alt="授权信息"></p>
<p>  请尊重原贴作者 与 本贴楼主。原作者把自己丰富的经验分享给了大家，本贴作者每个贴子平均花了3个小时翻译。<br>所以，转载请注明出处：</p>
<p>原贴地址：<a href="http://www.tonymacx86.com/yosemite-laptop-support/152573-guide-patching-laptop-dsdt-ssdts.html" target="_blank" rel="external">http://www.tonymacx86.com/yosemite-laptop-support/152573-guide-patching-laptop-dsdt-ssdts.html</a></p>
<p>本贴地址：<a href="http://bbs.pcbeta.com/viewthread-1571455-1-1.html" target="_blank" rel="external">http://bbs.pcbeta.com/viewthread-1571455-1-1.html</a></p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>  为了能让OS X的特性能够在普通PC上正常工作，就需要修改（可以利用补丁）DSDT和SSDT。本教程的目的，就是介绍如何利用现有补丁，修改你电脑的原始OEM DSDT/SSDT。</p>
<p>  虽然你可以用其它型号的电脑的DSDT，但这样的后果是会造成更多问题。你不能保证用别的型号电脑的DSDT是没问题的。如果你用了别的电脑的ACPI文件，即便是硬件配置非常相似，也可能会造成 系统不稳定 和 一些奇葩的问题。</p>
<p>使用补丁修改DSDT/SSDT包含了以下步骤：</p>
<ul>
<li>提取原始ACPI文件</li>
<li>反编译原始文件</li>
<li>分析并筛选这些原始文件</li>
<li>使用补丁修改</li>
<li>编译并保存，再放到引导特定的目录</li>
</ul>
<h2 id="提取原始ACPI文件"><a href="#提取原始ACPI文件" class="headerlink" title="提取原始ACPI文件"></a>提取原始ACPI文件</h2><p>  所有BIOS都实现了把ACPI文件提交给操作系统的功能。所以，基于任何操作系统，你都可以通过操作系统提取出原始ACPI文件，之后再进行修改。Linux、OS X、Windows、Clover都可以用来提取原始ACPI文件。这些方式提取的文件是完全相同的，只是由于使用的提取工具不同，文件名会不同。</p>
<p>  本教程将主要介绍3种提取方式：在OS X使用patchmatic工具（Rehabman编写的终端程序），在Clover启动界面按F4，还有使用Linux。</p>
<h3 id="使用patchmatic工具提取"><a href="#使用patchmatic工具提取" class="headerlink" title="使用patchmatic工具提取"></a>使用patchmatic工具提取</h3><p>  如果你已经有了OS X环境，并且还没有使用修改过的DSDT/SSDT，就可以使用patchmatic工具提取原始DSDT/SSDT。到这里下载编译好的patchmatic工具：<a href="https://github.com/RehabMan/OS-X-MaciASL-patchmatic" target="_blank" rel="external">https://github.com/RehabMan/OS-X-MaciASL-patchmatic</a> （仔细阅读patchmatic工具的README）。为了方便使用，你可以把程序拷贝到 /usr/bin 文件夹。（放到这里，在任何地方都可以调用）</p>
<p>  放好patchmatic之后，就可以在终端调用它了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cd ~/Desktop</div><div class="line">mkdir extract</div><div class="line">cd extract</div><div class="line">patchmatic -extract</div></pre></td></tr></table></figure>
<p>  patchmatic 工具将会提取这次启动被加载的 ACPI 文件 到当前目录。如果你用了 Clover 的 Fix 功能（Clover 会向 DSDT/SSDT 注入代码），那么得到的就不是原始文件了，所以，要确认你没有使用 Clover 的 Fix 功能。</p>
<p>另外的情况是，如果你设置了(变色龙) <code>DropSSDT=Yes</code>，或者 (Clover) <code>DropOem=true</code>，那么，引导程序就会自动屏蔽原始的 SSDT，这时用patchmatic 提取，就不会得到 SSDT 文件。还有就是，变色龙的 <code>GeneratePStates/GenerateCStates=Yes</code>,参数，或 Clover 的 <code>/ACPI/SSDT/Generate/CStates</code>，<code>/ACPI/SSDT/Generate/PStates</code> 参数，会生成并注入新的 SSDT（非原始 SSDT），这时，提取的 SSDT 在反编译的时候会出现问题。</p>
<p>  以上就是提取原始文件的注意事项。一般，在 Linux 提取或在 Clover 启动界面按 F4 提取更容易一些。</p>
<p>  注意：使用 <code>patchmatic -extract</code> 命令可以作为 确认你修改的 DSDT/SSDT 是否被成功加载了的非常有用的诊断工具。</p>
<h3 id="在Clover启动界面按F4提取"><a href="#在Clover启动界面按F4提取" class="headerlink" title="在Clover启动界面按F4提取"></a>在Clover启动界面按F4提取</h3><p>  在Clover启动界面，你可以按 “F4”键，Clover 会把原始ACPI文件提取到 EFI/Clover/ACPI/origin 目录。再进入系统，就可以在那个目录看到提取到的原始文件了。之后，就可以开始反编译、修改了。注意，有的 BIOS 可能按 F4 键没用，而需要 Fn+F4，所以，如果不确定的话，F4 和 Fn+F4 都按一次。提取的时候，你不会看到任何是否完成的提示，只是会因为正在写文件而出现一点延迟现象。如果是用 Clover 的USB 设备（U盘、硬盘）启动的，文件会被提取到USB设备，这样会感到比较明显的延迟。</p>
<p>  有时候，Clover 提取的 SSDT 可能会重复。重复的文件，会影响到反编译。如果你反编译的时候看到了这样的提示信息（duplicate definitions），就需要仔细检查重复的是哪个了（例如，看大小）。由于存在这样的问题，所以在 Linux 提取比较好。因为我还没有见过在 Linux 提取的出现重复的情况。</p>
<h3 id="在Linux提取（推荐，还可以顺便提取声卡codec）"><a href="#在Linux提取（推荐，还可以顺便提取声卡codec）" class="headerlink" title="在Linux提取（推荐，还可以顺便提取声卡codec）"></a>在Linux提取（推荐，还可以顺便提取声卡codec）</h3><p>  在Linux系统里，可以直接在系统分区里找到原始ACPI文件。你可以在 /sys/firmware/acpi/tables 和 /sys/firmware/acpi/tables/dynamic 看到。可以简单地用命令进行拷贝。</p>
<p>  Linux系统不需要安装，做一个启动U盘就可以了：<a href="http://www.ubuntu.com/download/desktop/create-a-usb-stick-on-windows（3楼有楼主翻译的制作步骤）" target="_blank" rel="external">http://www.ubuntu.com/download/desktop/create-a-usb-stick-on-windows（3楼有楼主翻译的制作步骤）</a></p>
<p>打开Linux的终端输入：<br>sudo cp -R /sys/firmware/acpi/tables DEST<br>注意： 用FAT32格式的USB设备（U盘、硬盘）的挂载点的路径，替换命令里的 DEST</p>
<p>（提取DSDT/SSDT的图文说明，请看下一楼）</p>
<p>  你的U盘或硬盘需要是FAT32格式的。FAT32格式可以避免出现文件权限问题，因为FAT32格式在Linux系统里没有文件权限的问题。用于替换DEST的 自动挂载的USB设备的名字，取决于你的Linux版本和它的启动方式。你可以在终端输入 mount 命令，来查看当前的挂载点。或者，在图形界面，把鼠标移到文件管理器上相应的USB设备名上。</p>
<blockquote>
<p>Nero：我将原帖三楼的步骤迁移到这里来了。</p>
</blockquote>
<h4 id="制作Ubuntu启动U盘"><a href="#制作Ubuntu启动U盘" class="headerlink" title="制作Ubuntu启动U盘"></a>制作Ubuntu启动U盘</h4><p>（感谢stevechen962464的点评，对于UEFI引导的，可以这样：直接下载Ubuntu的x64版本。然后所有文件丢进U盘。即可从UEFI启动ubuntu。不需要这样写入。）</p>
<p>以下为传统BIOS引导的情况：</p>
<p>要在U盘运行Ubuntu，需要一个空闲空间至少2G的U盘。<br>制作Ubuntu启动U盘的最简单的方法，是使用 Universal USB installer 。</p>
<p>软件下载地址：<br><a href="http://www.pendrivelinux.com/universal-usb-installer-easy-as-1-2-3/#button" target="_blank" rel="external">http://www.pendrivelinux.com/universal-usb-installer-easy-as-1-2-3/#button</a></p>
<p>制作步骤：</p>
<h5 id="1-下载制作软件："><a href="#1-下载制作软件：" class="headerlink" title="1. 下载制作软件："></a>1. 下载制作软件：</h5><p><a href="http://www.pendrivelinux.com/universal-usb-installer-easy-as-1-2-3/#button" target="_blank" rel="external">http://www.pendrivelinux.com/universal-usb-installer-easy-as-1-2-3/#button</a></p>
<h5 id="2-下载Ubuntu"><a href="#2-下载Ubuntu" class="headerlink" title="2. 下载Ubuntu"></a>2. 下载Ubuntu</h5><p>楼主提供的是 Ubuntu 14.10 64位。如果需要其它版本，或者下载速度慢的话，请自行搜索下载。<br><del>下载地址：<a href="http://pan.baidu.com/s/1o6zD0Lk" target="_blank" rel="external">http://pan.baidu.com/s/1o6zD0Lk</a> 提取码:u9d</del></p>
<blockquote>
<p>以上地址已失效。最新 Ubuntu 官方地址。<a href="http://releases.ubuntu.com/16.04.1/" target="_blank" rel="external">Ubuntu  16.04.1 LTS</a></p>
<p>16.04 和 14.10提取的操作步骤完全一样，这里就不提供14.10的下载地址，如果需要 Ubuntu 官网上有。<br>我下载的镜像是 64-bit PC (AMD64) desktop image，可以根据自己实际情况选择。</p>
</blockquote>
<h5 id="3-在下拉列表选择-Ubuntu"><a href="#3-在下拉列表选择-Ubuntu" class="headerlink" title="3. 在下拉列表选择 Ubuntu"></a>3. 在下拉列表选择 Ubuntu</h5><p><img src="/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-02.jpg" alt="Universal USB Installer 01"></p>
<h5 id="4-点击“Browser”浏览，选择下载好的iso镜像"><a href="#4-点击“Browser”浏览，选择下载好的iso镜像" class="headerlink" title="4. 点击“Browser”浏览，选择下载好的iso镜像"></a>4. 点击“Browser”浏览，选择下载好的iso镜像</h5><p><img src="/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-03.jpg" alt="Universal USB Installer 03"></p>
<h5 id="5-选择U盘，点击“Create”，开始创建启动U盘"><a href="#5-选择U盘，点击“Create”，开始创建启动U盘" class="headerlink" title="5. 选择U盘，点击“Create”，开始创建启动U盘"></a>5. 选择U盘，点击“Create”，开始创建启动U盘</h5><p><img src="/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-04.jpg" alt="Universal USB Installer 04"></p>
<h5 id="6-从U盘启动，选择试用-Ubuntu。"><a href="#6-从U盘启动，选择试用-Ubuntu。" class="headerlink" title="6. 从U盘启动，选择试用 Ubuntu。"></a>6. 从U盘启动，选择试用 Ubuntu。</h5><h4 id="提取-DSDT-SSDT"><a href="#提取-DSDT-SSDT" class="headerlink" title="提取 DSDT/SSDT"></a>提取 DSDT/SSDT</h4><h5 id="1-查看U盘或硬盘的挂载点（把鼠标移动到U盘名字上）。"><a href="#1-查看U盘或硬盘的挂载点（把鼠标移动到U盘名字上）。" class="headerlink" title="1. 查看U盘或硬盘的挂载点（把鼠标移动到U盘名字上）。"></a>1. 查看U盘或硬盘的挂载点（把鼠标移动到U盘名字上）。</h5><p>如图，楼主的U盘挂载点是 <code>/media/ubuntu/DISK_IMG</code></p>
<p><img src="/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-05.png" alt="Ubuntu extract DSDT/SSDT-1"></p>
<h5 id="2-点击左上角第一个图标，搜索，找到终端。"><a href="#2-点击左上角第一个图标，搜索，找到终端。" class="headerlink" title="2. 点击左上角第一个图标，搜索，找到终端。"></a>2. 点击左上角第一个图标，搜索，找到终端。</h5><p><img src="/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-06.png" alt="Ubuntu extract DSDT/SSDT-2"></p>
<p>搜索 ter，找到终端</p>
<p><img src="/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-07.png" alt="Ubuntu extract DSDT/SSDT-3"></p>
<h5 id="3-使用命令拷贝文件"><a href="#3-使用命令拷贝文件" class="headerlink" title="3. 使用命令拷贝文件"></a>3. 使用命令拷贝文件</h5><p>（注意，不能使用图形界面的复制、粘贴，会提示权限不允许）</p>
<p>如图，前面一个路径都是一样的，我们需要从这个获取文件。中间空格隔开。后面一个路径，是你第一步看好的挂载点。</p>
<p>（<strong>还可以 在空格 后把自己的目标目录拖至此处。</strong>也就是先输好前面的命令和路径，再输一个空格，再在图形界面把U盘拖到终端。）</p>
<p><img src="/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-08.png" alt="Ubuntu extract DSDT/SSDT-4"></p>
<h5 id="4-在U盘新建一个文件夹，放-DSDT-SSDT（U盘必须是FAT32格式）"><a href="#4-在U盘新建一个文件夹，放-DSDT-SSDT（U盘必须是FAT32格式）" class="headerlink" title="4. 在U盘新建一个文件夹，放 DSDT/SSDT（U盘必须是FAT32格式）"></a>4. 在U盘新建一个文件夹，放 DSDT/SSDT（U盘必须是FAT32格式）</h5><p>因为，我们拷贝的目录结构是这样的：</p>
<p><strong>tables （有DSDT和SSDT）</strong></p>
<p><strong>—-dynamic （还有SSDT）</strong></p>
<p>我们需要把两处的文件，移动到同一个文件夹。这样才好管理，也方便以后一起反编译。</p>
<p>如图，楼主在U盘新建了一个名为my_acpi的文件夹（文件夹名自己取就行），来存放文件。</p>
<p><img src="/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-09.png" alt="Ubuntu extract DSDT/SSDT-5"></p>
<h5 id="5-给所有文件，都加上-aml-后缀名。"><a href="#5-给所有文件，都加上-aml-后缀名。" class="headerlink" title="5. 给所有文件，都加上 .aml 后缀名。"></a>5. 给所有文件，都加上 .aml 后缀名。</h5><p>操作如图所示：（楼主用的是虚拟机，文件不全）</p>
<p><img src="/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-10.png" alt="Ubuntu extract DSDT/SSDT-6"></p>
<p><img src="/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-11.png" alt="Ubuntu extract DSDT/SSDT-7"></p>
<p><img src="/2017/01/16/extract_edit_dsdt/extract_edit_dsdt-12.png" alt="Ubuntu extract DSDT/SSDT-8"></p>
<h5 id="6-所有操作完成后，可以再按下面的方法提取声卡codec。"><a href="#6-所有操作完成后，可以再按下面的方法提取声卡codec。" class="headerlink" title="6. 所有操作完成后，可以再按下面的方法提取声卡codec。"></a>6. 所有操作完成后，可以再按下面的方法提取声卡codec。</h5><p>制作Ubuntu启动U盘，一方面，可以提取ACPI文件。另一方面，还可以提取声卡codec。</p>
<p>提取ACPI文件，请看本贴前面的内容。这里补充下提取声卡codec。</p>
<p>打开终端（Terminal）：</p>
<p>输入 </p>
<p><code>cat /proc/asound/card0/codec#0 &gt; ~/Desktop/Codec.txt</code>；</p>
<p>或者 </p>
<p><code>cat /proc/asound/card0/codec#1 &gt; ~/Desktop/Codec.txt</code>；</p>
<p>或者 </p>
<p><code>cat /proc/asound/card0/codec#2 &gt; ~/Desktop/Codec.txt</code>。</p>
<p>(取決声卡的 Address，这几个命令都试试，直到看到桌面出现了Codec.txt文件)</p>
<p>成功的话，在桌面会出现一个 Codec.txt （打开看看，应该有很多内容，确认不是空的）</p>
<p>把Codec.txt拷贝到U盘。</p>
<p>这种方法是先把文件拷贝到桌面，就可以用图形界面的复制、粘贴了。</p>
<p>（拷贝文件，可以和前面的结合参考，哪种方便用哪种。只是要注意，U盘格式最好是 FAT32 格式。）</p>
<h2 id="反编译ACPI文件"><a href="#反编译ACPI文件" class="headerlink" title="反编译ACPI文件"></a>反编译ACPI文件</h2><p>  虽然提取到的 aml 文件可以用 MaciASL 直接打开，但不建议这样做。用 MaciASL 直接打开 aml 文件，是软件在做对打开的这个文件的单独反编译。然而，ACPI 文件之间有着紧密的联系，只对一个文件单独反编译，得到的文件会包含许多难于修复的错误。</p>
<p>  所以，最好的方法是，使用 iasl 编译器，同时反编译所有文件。要做的准备工作有，新建一个文件夹用于存放所有 DSDT 和 SSDT 文件，并重命名所有文件，例如加上 .aml 扩展名。下载最新的iasl 编译器来进行反编译。这里是 Rehabman 的修改版编译器：<a href="https://bitbucket.org/RehabMan/acpica/downloads" target="_blank" rel="external">https://bitbucket.org/RehabMan/acpica/downloads</a>。把iasl编译器拷贝到/usr/bin目录，会让调用iasl更方便。</p>
<p>终端的反编译命令：<br>cd “你存放DSDT和SSDT的文件夹名”<br>iasl -da -dl *.aml</p>
<p><strong>楼主补充：</strong></p>
<p>1、反编译介绍：<a href="http://bbs.pcbeta.com/viewthread-1475332-1-1.html" target="_blank" rel="external">http://bbs.pcbeta.com/viewthread-1475332-1-1.html</a></p>
<p>2、视频教程：<a href="http://bbs.pcbeta.com/viewthread-1569867-1-1.html" target="_blank" rel="external">http://bbs.pcbeta.com/viewthread-1569867-1-1.html</a></p>
<p>  注意：不要用-da 命令去反编译 DSDT和SSDT以外的 ACPI文件，那将是无效的。</p>
<p>  反编译成功后，你将得到 所有文件的dsl形式，修改就是使用dsl文件进行。修改好dsl文件后，使用MaciASL的 另存为，并选择 文件格式 “ACPI Machine Language Binary” ，再在文件名那里加上 .aml扩展名，保存。编译保存为aml之后，把它们放到引导程序规定的加载目录（变色龙 /Extra，Clover /EFI/Clover/ACPI/patched）。保存好dsl文件，以后修改还要用dsl文件。</p>
<h2 id="筛选ACPI文件"><a href="#筛选ACPI文件" class="headerlink" title="筛选ACPI文件"></a>筛选ACPI文件</h2><p>  生成的 SSDT 和原始的 SSDT 会产生冲突。大部分关于电源管理的贴子，会让删除所有原始的 SSDT。但删除所有 SSDT 并不好，特别是对于一些新的电脑来说，很多代码都从 DSDT 移到了 SSDT 里，最好不要一棒子把所有 SSDT 都打掉。只需要 把和 CPU 相关的 SSDT 删除就可以了，因为这样的 SSDT 对黑苹果没有效果（也许它们还会造成其它问题），留下其它有用的 SSDT，用于打补丁或者就保留着不做修改。</p>
<p>  在反编译成功后，一个一个地打开检查 dsl 文件，以确认每一个具有的功能。如果是和 CPU 有关的，就把它拖到其它地方（也可以直接删除），最后放到加载目录的，<del>不需要这些提取的 CPU 相关的 SSDT。一般，和 CPU 相关的 SSDT 包含了 Scope _PR.CPIx 这样的声明，可以通过这样的名字排除文件。</del></p>
<blockquote>
<p>Nero：这里作者在别的帖子里面修正了这种说法，只需要删掉 <code>OEM Table ID     &quot;CpuPm&quot;</code>这个 SSDT，利用 ssdtPRGen 脚本重新生成这个 SSDT 即可。</p>
</blockquote>
<p>  额外说明：对于 Rehabman 的联想 U430，他试验了使用这些提取的 CPU 相关的 SSDT（当然，是修复了错误的）。不确定这是不是有什么好处，但使用了提取的 CPU 相关 SSDT，使得他的 DSDT 不再需要打”Fix PNOT/PPNT”这样的补丁了，好像电脑工作得很完美。</p>
<p>以下是常见的SSDT的特点和功能：</p>
<ul>
<li><p>SATA：可以留，也可以不留，自己决定就好。</p>
</li>
<li><p>PTID：一般对苹果系统来说，是没用的。也许这个文件还会有很多错误。一种比较少的应用情况是，在这个文件里，可以找到 读取风扇转速，温度，或者其它系统状态 的线索。</p>
</li>
<li><p>IAOE：如果存在这个文件，通常来讲，它会在DSDT里的 _PTS 和 _WAK 方法被调用。如果删除这个文件，就会影响到睡眠。</p>
</li>
<li><p>GFX0：通常包含了 Device GFX0 的SSDT，是和 集成显卡 相关的。亮度补丁就是针对这样的文件的。老的笔记本（Haswell以前的），GFX0一般是定义在DSDT里。Haswell的笔记本，它被定义在SSDT里（虽然也可以移到DSDT里）。</p>
</li>
<li><p>PEGP：包含PEGP的文件，一般是和 独显 和 双显卡切换 有关。有时候不只有一个这样的SSDT，为了实现 屏蔽独显 等功能，你需要保留所有包含PEGP的SSDT，并对它们做一些修改。</p>
</li>
</ul>
<p>我们需要弄清楚，每个SSDT的大概是做什么的，哪些需要删除，哪些需要不做修改地保留，哪些需要修改。</p>
<h2 id="修复错误"><a href="#修复错误" class="headerlink" title="修复错误"></a>修复错误</h2><p>  即使同时反编译所有文件（使用iasl的-da参数），还是难免存在错误。反编译后的文件之所以还会有错误，是因为一直以来iasl编译器的版本都在更新、iasl的实现细节变化了、不同的电脑与系统环境。存在这些错误的原因可能是（Rehabman认为），里面调用到的一些方法，实际上是Windows内部实现的（例如 MMTB方法和MDBG方法）。实际也有这样的情况，ACPI文件的代码原本就存在缺陷或者某些代码本来就是无效的（很难说得清楚）。</p>
<p>  好了，在确认哪些文件是你需要的之后，就需要开始对它们进行修改了（修复错误、添加功能性代码），直到编译没有错误。现在有很多补丁源可以提供使用。</p>
<p>MaciASL软件：<a href="https://github.com/RehabMan/OS-X-MaciASL-patchmatic" target="_blank" rel="external">https://github.com/RehabMan/OS-X-MaciASL-patchmatic</a></p>
<p>Rehabman的综合补丁源：<a href="https://github.com/RehabMan/Laptop-DSDT-Patch" target="_blank" rel="external">https://github.com/RehabMan/Laptop-DSDT-Patch</a></p>
<p><strong>楼主补充：</strong></p>
<p>1、MaciASL汉化版：<a href="http://bbs.pcbeta.com/viewthread-1495779-1-1.html" target="_blank" rel="external">http://bbs.pcbeta.com/viewthread-1495779-1-1.html</a></p>
<p>2、Rehabman补丁源（汉化版自带，添加到软件才能访问）：<a href="http://raw.github.com/RehabMan/Laptop-DSDT-Patch/master" target="_blank" rel="external">http://raw.github.com/RehabMan/Laptop-DSDT-Patch/master</a></p>
<p>  注意：以上补丁源里的补丁，没有在DSDT Editor软件里测试过。DSDT Editor软件存在着很多bug，内置的编译器也很老了。</p>
<p>  在看别人的项目页面的时候，都请仔细阅读作者提供的README，到正确的地址下载软件，学习配置MaciASL。修复语法错误的补丁的名字，以[syn]开头。例如，对于一些比较老的电脑，提供了”Fix _PLD Buffer/Package Error”, “Fix TNOT Error”, 和 “Fix FPED Parse Error”补丁。为了确定你需要用哪个补丁，需要看 编译结果 窗口给出的 提示信息，再定位到提示的行，查看错误行前后都有什么样的代码。你也可以尝试，只要Changes不为0或者预览框里有显示（说明可以打）的补丁，都可以打。如果你不熟悉编译结果的错误提示，可以一个一个试验看看能不能打。</p>
<p>  对于一些错误，你可以简单地删除造成错误的那行代码来解决。当然，这要取决于这一行代码对于功能的实现，是否是必需的。例如，对于由External语句造成的错误，一般可以删除那行代码以修复错误。如果需要，你自己可以做一个删除这样的错误行代码的补丁。</p>
<p>  学习一下ACPI规范 和 具有一些编程经验，有助于处理DSDT和SSDT。</p>
<p>  我们的最终目的，是得到 编译没有错误的dsl文件（warnings/remarks/optimizations都不用管）。一旦你修复了所有错误，就可以开始为了你的黑苹果 添加功能、解决某些问题，而修改dsl文件了（使用现有补丁或手工修改）。</p>
<h2 id="常用补丁"><a href="#常用补丁" class="headerlink" title="常用补丁"></a>常用补丁</h2><p>  一般，你需要先弄清自己的需求，再根据需求选择要用的补丁。但也有一些补丁是通用的，并且这些补丁一般不会造成什么问题。例如，Rehabman的补丁源里的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&quot;Fix _WAK Arg0 v2&quot;</div><div class="line">&quot;HPET Fix&quot;</div><div class="line">&quot;SMBUS Fix&quot;</div><div class="line">&quot;IRQ Fix&quot;</div><div class="line">&quot;RTC Fix&quot;</div><div class="line">&quot;OS Check Fix&quot;</div><div class="line">&quot;Fix Mutex with non-zero SyncLevel&quot;</div><div class="line">&quot;Fix PNOT/PPNT&quot;</div><div class="line">&quot;Add IMEI”</div></pre></td></tr></table></figure>
<p>USB补丁，用于解决 睡眠自动唤醒 的问题。</p>
<p>根据自己电脑的硬件配置选择USB补丁：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&quot;6-series USB&quot;</div><div class="line">&quot;7-series/8-series USB”</div></pre></td></tr></table></figure>
<p>  USB3 Mutliplex补丁，有助于加载AppleUSBXHCI.kext（原生USB3.0驱动），于是就不需要安装第三方的GenericUSBXCHI.kext了。这个补丁是基于Mieze的发现而制作的。大部分DSDT需要对它做一些修改，才能使用（不然可能会提示有错误）。例如，对于惠普的Probook，Rehabman制作了这个补丁的修改版本。联想u310/u410可以直接使用这个补丁：</p>
<p><code>&quot;7-series USB3 Multiplex”</code></p>
<p>  如果你的电脑是Haswell架构、8系列芯片组的，并且还没有加载AppleLPC.kext（电源管理的一种），你可以使用这个补丁，注入一个兼容ID，以加载AppleLPC：</p>
<p><code>&quot;Haswell LPC”</code></p>
<p>  还需要考虑对一些设备名进行改名，并且，改名还要改得彻底。可以把一些设备名改成符合苹果规范的名字。（例如，使用”Rename GFX0 to IGPU”补丁，可以加载集成显卡的电源管理）。对于这一情况，DSDT/SSDT里，包含的所有GFX0，都需要改成IGPU（对所有含有GFX0的文件，都应用这个补丁）。</p>
<p>  关于重复的标识符定义：你必须确保，你修改后的文件，不包含重复的标识符。典型的例子有，在需要添加一个_DSM方法的时候，在同一个范围里，原本已经存在_DSM方法了。编译器就会提示标识符重复。为了避免这样的问题，你可以一开始就对DSDT/SSDT用”Remove _DSM methods”补丁，删除原本存在的所有_DSM方法。</p>
<h2 id="关于一些特别的需求的修改"><a href="#关于一些特别的需求的修改" class="headerlink" title="关于一些特别的需求的修改"></a>关于一些特别的需求的修改</h2><h4 id="电池状态显示："><a href="#电池状态显示：" class="headerlink" title="电池状态显示："></a>电池状态显示：</h4><p>1、原贴：<a href="http://www.tonymacx86.com/mavericks-laptop-support/116102-how-patch-dsdt-working-battery-status.html" target="_blank" rel="external">[GUIDE] How to patch DSDT for working battery status</a></p>
<p>2、楼主翻译：<a href="http://bbs.pcbeta.com/viewthread-1521462-1-1.html" target="_blank" rel="external">http://bbs.pcbeta.com/viewthread-1521462-1-1.html</a></p>
<h4 id="屏幕亮度调节："><a href="#屏幕亮度调节：" class="headerlink" title="屏幕亮度调节："></a>屏幕亮度调节：</h4><p>1、原贴：<a href="http://www.tonymacx86.com/yosemite-laptop-support/152659-guide-patching-dsdt-ssdt-laptop-backlight-control.html" target="_blank" rel="external">http://www.tonymacx86.com/yosemite-laptop-support/152659-guide-patching-dsdt-ssdt-laptop-backlight-control.html</a></p>
<p>2、楼主翻译：<a href="http://bbs.pcbeta.com/viewthread-1571456-1-1.html" target="_blank" rel="external">http://bbs.pcbeta.com/viewthread-1571456-1-1.html</a></p>
<p>  当你在看某个特定型号的安装教程的时候，作者都会介绍用了哪些补丁，或者直接提供下载。你能容易的看出来，他们的补丁和Rehabman的补丁，在语法上是相似的。（例如这样的语法：’into_all method label FOO code_regex xxyy removeall_matched;’）。这些补丁语句需要粘贴到MaciASL的补丁窗口，再应用。</p>
<p>  如果你对制作补丁有兴趣，可以去看这里的MaciASL补丁语法说明：<a href="http://sourceforge.net/p/maciasl/wiki/Patching%20Syntax%20Grammar/" target="_blank" rel="external">http://sourceforge.net/p/maciasl/wiki/Patching%20Syntax%20Grammar/</a></p>
<p>  注意：在许多情况下，DSDT的补丁是和某个第三方kext、打过补丁的kext、Clover实时打补丁的kext相结合使用的（通过DSDT代码加载kext）。</p>
<h2 id="仿冒声卡驱动相关的补丁"><a href="#仿冒声卡驱动相关的补丁" class="headerlink" title="仿冒声卡驱动相关的补丁"></a>仿冒声卡驱动相关的补丁</h2><p>  有两个和仿冒声卡驱动相关的补丁，需要和仿冒的声卡kext一起使用：<br>“Audio Layout 12” (根据实际情况，自己修改 layout-id，例如把 12 改成 28 等)<br>“IRQ Fix”（解决需要-f才能加载声卡驱动的问题）</p>
<p>  注意，你需要有适合你的声卡的AppleHDA，还要知道这个仿冒声卡驱动用的是哪个layout-id。layout-id的值，是由修改驱动的人决定的。</p>
<p>  要查看别人修改的AppleHDA用的layout-id是哪个值，首先，你需要知道自己声卡的codec id的十进制形式（例如，0x10ec0269 = 283902569）。然后，去查看 AppleHDA.kext/Contents/PlugIns/AppleHDAHardwareConfigDriver.kext/Contents/Info.plist，查看HDAConfigDefault节点下面的codec id（这个节点下，可能有一组或多组数据，所以，刚才的283902569就用上了）。和你的codec id匹配的那组里，LayoutID的值，就是你需要的layout-id值。有的驱动修改者，同一个codec id可能会对应多个layout-id，选择一个你需要的layout-id注入。</p>
<h2 id="让引导加载修改、编译好的文件"><a href="#让引导加载修改、编译好的文件" class="headerlink" title="让引导加载修改、编译好的文件"></a>让引导加载修改、编译好的文件</h2><p>  为了使用你修改、编译好的DSDT/SSDT，你需要把它们放到引导能加载它们的目录。每种引导的加载目录是唯一的，且对文件的命名要求也不同。如果用MaciASL保存，另存为的时候，文件格式一定要选择”ACPI Machine Language Binary”（文件－另存为－文件格式），再自己加上 .aml 后缀。如果不选择文件格式，就相当于，硬是把dsl文本文件，存成了aml字节码文件（没有经过编译器转换），这会造成无法预知的问题。</p>
<p>  Clover：aml文件应该放到Clover所在的分区（通常是EFI分区），如果存在 EFI/Clover/ACPI/patched. DSDT.aml，引导程序就会用这里的DSDT，替代掉原始的DSDT，提交给系统。Clover 3062版本以前，SSDT的命名必须是这样的：SSDT-x 或 SSDT-xx，x是一个整数（一直支持到SSDT-19）。Clover允许SSDT的名字不连续（例如，SSDT-1.aml, SSDT-5.aml, SSDT-6.aml是可以的）。Clover 3062以后的版本，会加载所有在ACPI/patched里的aml文件，对名字没有严格限制了。一定要注意，SSDT的加载顺序非常重要，你留下来的SSDT，要保持提取的时候的顺序。</p>
<p>  关于Clover 3062版本以后的注意事项：ACPI/patched里SSDT的加载方式的改变，造成了加载顺序的不确定性。你应该要使用 config.plist/ACPI/SortedOrder 功能，指定SSDT的加载顺序。到这里可以看到更多细节：<a href="http://www.projectosx.com/forum/index.php?showtopic=2656&amp;view=findpost&amp;p=43690" target="_blank" rel="external">http://www.projectosx.com/forum/index.php?showtopic=2656&amp;view=findpost&amp;p=43690</a>。</p>
<p>  Clover 3088版本以后，实现了SortedOrder参数。更多相关信息可以到这里查看：<a href="http://www.projectosx.com/forum/index.php?showtopic=2562&amp;view=findpost&amp;p=43674" target="_blank" rel="external">http://www.projectosx.com/forum/index.php?showtopic=2562&amp;view=findpost&amp;p=43674</a></p>
<p>  变色龙（或Chimera）：修改、编译好的DSDT/SSDT，应该放到 系统盘的 /Extra（或者你的引导程序所在的其它地方的 /Extra）。如果/Extra里存在DSDT.aml，引导程序就会用这里的DSDT，替代掉原始的DSDT，提交给系统。变色龙要求，SSDT的名字是连续的。这样的情况，文件都会被加载：SSDT.aml, SSDT-1.aml, SSDT-2.aml, SSDT-3.aml，直到引导找不到接下来的名字的文件。另外，这样的情况：SSDT.aml, SSDT-1.aml, SSDT-4.aml, SSDT-5.aml，只会加载SSDT.aml 和 SSDT-1.aml。SSDT-4.aml 和 SSDT-5.aml不会被加载（变色龙会忽略这些文件）。</p>
<p>  最后，如果不先屏蔽原始的OEM SSDT，就不能放自己修改的SSDT。最简单的方法，是设置DropSSDT=Yes（变色龙） 或者 ACPI/SSDT/DropOem=true（Clover），从而在系统启动的时候，先屏蔽原始的SSDT，之后再把目录里的SSDT（没有修改或修改过）提交给系统。</p>
<h2 id="Floating-regions"><a href="#Floating-regions" class="headerlink" title="Floating regions"></a>Floating regions</h2><p>  根据ACPI规范，OperationRegion可以被具体定义为 MMIO region, SystemMemory region, EmbeddedControl region 等。这些region通常包含了 修正过的 地址值，这些地址值 由 硬件构成、BIOS版本、BIOS设置 决定。这些region随时可能 随机地、不可预计地 发生改变。也就是所谓的”floating regions”（动态域）。</p>
<p>  我们提取的DSDT/SSDT里的Regin，只是某一个时间点的状态，当BIOS发出命令，需要变动地址值时，我们提取的文件是做不到这样的变动的。在这样的情况下，你也许能注意到，某一个特定的功能变得断断续续，或者可能随机地出现一些稳定性问题。</p>
<p>  综上而论，使用Clover的FixRegions功能，将是很好的解决办法。你可以在Clover的Wiki找到关于这个功能的说明。（国外的）论坛里的安装教程提供的config.plist都配置了这个参数。注意：只有在DSDT里的floating region，才能用这个参数修复。要修复SSDT里的floating region是非常困难的，目前，除了不处理SSDT里随机变动的floating region以外，还没有什么好的解决方案。研究floating region的处理，超出了本教程讨论的范围。</p>
<h2 id="本教程用到的资源"><a href="#本教程用到的资源" class="headerlink" title="本教程用到的资源"></a>本教程用到的资源</h2><p>MaciASL (RehabMan fork): <a href="https://github.com/RehabMan/OS-X-MaciASL-patchmatic" target="_blank" rel="external">https://github.com/RehabMan/OS-X-MaciASL-patchmatic</a></p>
<p>patchmatic: <a href="https://github.com/RehabMan/OS-X-MaciASL-patchmatic" target="_blank" rel="external">https://github.com/RehabMan/OS-X-MaciASL-patchmatic</a></p>
<p>iasl (RehabMan fork): <a href="https://bitbucket.org/RehabMan/acpica/downloads" target="_blank" rel="external">https://bitbucket.org/RehabMan/acpica/downloads</a></p>
<p>ACPI 规范: <a href="http://acpi.info/spec.htm" target="_blank" rel="external">http://acpi.info/spec.htm</a></p>
<p>RehabMan github: <a href="https://github.com/RehabMan?tab=repositories" target="_blank" rel="external">https://github.com/RehabMan?tab=repositories</a></p>
<p>Clover laptop guide: <a href="http://www.tonymacx86.com/yosemite-laptop-support/146864-guide-booting-os-x-installer-laptops-unibeast.html" target="_blank" rel="external">[GUIDE] Booting the OS X installer on LAPTOPS with Clover UEFI</a></p>
<p>Clover config.plist files for laptops: <a href="https://github.com/RehabMan/OS-X-Clover-Laptop-Config" target="_blank" rel="external">https://github.com/RehabMan/OS-X-Clover-Laptop-Config</a></p>
<p>Clover thread: <a href="http://www.projectosx.com/forum/index.php?showtopic=2562" target="_blank" rel="external">http://www.projectosx.com/forum/index.php?showtopic=2562</a></p>
<p>Clover changes: <a href="http://www.projectosx.com/forum/index.php?showtopic=2656" target="_blank" rel="external">http://www.projectosx.com/forum/index.php?showtopic=2656</a></p>
<p>Clover installer discussion: <a href="http://www.projectosx.com/forum/index.php?showtopic=3191" target="_blank" rel="external">http://www.projectosx.com/forum/index.php?showtopic=3191</a></p>
<h2 id="楼主总结"><a href="#楼主总结" class="headerlink" title="楼主总结"></a>楼主总结</h2><p>  对DSDT/SSDT的修改，首先，提取这一步也很关键，虽然提取的方法很多，但最推荐的是用Linux提取。对提取好的文件，同时反编译所有文件，可以得到错误少的dsl文件。修改就用这些dsl文件修改，根据教程，筛选出要留下来的文件。再用很多现有的补丁源（有修复的，也有添加某些功能的）修改。修改好后，编译成aml文件使用（不要用软件打开aml文件）。还要注意SSDT的命名，最好名字连续。最后，放到相应的加载目录。</p>
<p>可以结合楼主录制的视频教程学习：</p>
<p>1、新视频（2015.1.2发布）：<a href="http://bbs.pcbeta.com/viewthread-1569867-1-1.html" target="_blank" rel="external">http://bbs.pcbeta.com/viewthread-1569867-1-1.html</a></p>
<p>2、老视频（2014.6.8发布）：<a href="http://bbs.pcbeta.com/viewthread-1517830-1-1.html" target="_blank" rel="external">http://bbs.pcbeta.com/viewthread-1517830-1-1.html</a></p>
<p>3、反编译介绍：<a href="http://bbs.pcbeta.com/viewthread-1475332-1-1.html" target="_blank" rel="external">http://bbs.pcbeta.com/viewthread-1475332-1-1.html</a></p>
<p>4、MaciASL汉化版：<a href="http://bbs.pcbeta.com/viewthread-1495779-1-1.html" target="_blank" rel="external">http://bbs.pcbeta.com/viewthread-1495779-1-1.html</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/黑苹果/" rel="tag"># 黑苹果</a>
          
            <a href="/tags/Mac/" rel="tag"># Mac</a>
          
            <a href="/tags/Hackintosh/" rel="tag"># Hackintosh</a>
          
            <a href="/tags/dsdt/" rel="tag"># dsdt</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/01/14/2017-1-14-blog/" rel="next" title="最近小记（2017年01月14日）">
                <i class="fa fa-chevron-left"></i> 最近小记（2017年01月14日）
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/01/18/ASUS-VM510LI-Hackintosh/" rel="prev" title="华硕 VM510LI 黑苹果手记">
                华硕 VM510LI 黑苹果手记 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="lv-container" data-id="city" data-uid="MTAyMC8yOTYyMi82MTkw"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="Nero Hau" />
          <p class="site-author-name" itemprop="name">Nero Hau</p>
           
              <p class="site-description motion-element" itemprop="description">这里就是一堆流水账和技术笔记 | LINUX初学者 | 黑苹果初学者</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">27</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">43</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/NeroNeroxps" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/neroxps" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#本文说明"><span class="nav-number">1.</span> <span class="nav-text">本文说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#翻译授权信息"><span class="nav-number">2.</span> <span class="nav-text">翻译授权信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#概述"><span class="nav-number">3.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#提取原始ACPI文件"><span class="nav-number">4.</span> <span class="nav-text">提取原始ACPI文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用patchmatic工具提取"><span class="nav-number">4.1.</span> <span class="nav-text">使用patchmatic工具提取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在Clover启动界面按F4提取"><span class="nav-number">4.2.</span> <span class="nav-text">在Clover启动界面按F4提取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在Linux提取（推荐，还可以顺便提取声卡codec）"><span class="nav-number">4.3.</span> <span class="nav-text">在Linux提取（推荐，还可以顺便提取声卡codec）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#制作Ubuntu启动U盘"><span class="nav-number">4.3.1.</span> <span class="nav-text">制作Ubuntu启动U盘</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-下载制作软件："><span class="nav-number">4.3.1.1.</span> <span class="nav-text">1. 下载制作软件：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-下载Ubuntu"><span class="nav-number">4.3.1.2.</span> <span class="nav-text">2. 下载Ubuntu</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-在下拉列表选择-Ubuntu"><span class="nav-number">4.3.1.3.</span> <span class="nav-text">3. 在下拉列表选择 Ubuntu</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-点击“Browser”浏览，选择下载好的iso镜像"><span class="nav-number">4.3.1.4.</span> <span class="nav-text">4. 点击“Browser”浏览，选择下载好的iso镜像</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-选择U盘，点击“Create”，开始创建启动U盘"><span class="nav-number">4.3.1.5.</span> <span class="nav-text">5. 选择U盘，点击“Create”，开始创建启动U盘</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-从U盘启动，选择试用-Ubuntu。"><span class="nav-number">4.3.1.6.</span> <span class="nav-text">6. 从U盘启动，选择试用 Ubuntu。</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#提取-DSDT-SSDT"><span class="nav-number">4.3.2.</span> <span class="nav-text">提取 DSDT/SSDT</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-查看U盘或硬盘的挂载点（把鼠标移动到U盘名字上）。"><span class="nav-number">4.3.2.1.</span> <span class="nav-text">1. 查看U盘或硬盘的挂载点（把鼠标移动到U盘名字上）。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-点击左上角第一个图标，搜索，找到终端。"><span class="nav-number">4.3.2.2.</span> <span class="nav-text">2. 点击左上角第一个图标，搜索，找到终端。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-使用命令拷贝文件"><span class="nav-number">4.3.2.3.</span> <span class="nav-text">3. 使用命令拷贝文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-在U盘新建一个文件夹，放-DSDT-SSDT（U盘必须是FAT32格式）"><span class="nav-number">4.3.2.4.</span> <span class="nav-text">4. 在U盘新建一个文件夹，放 DSDT/SSDT（U盘必须是FAT32格式）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-给所有文件，都加上-aml-后缀名。"><span class="nav-number">4.3.2.5.</span> <span class="nav-text">5. 给所有文件，都加上 .aml 后缀名。</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-所有操作完成后，可以再按下面的方法提取声卡codec。"><span class="nav-number">4.3.2.6.</span> <span class="nav-text">6. 所有操作完成后，可以再按下面的方法提取声卡codec。</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#反编译ACPI文件"><span class="nav-number">5.</span> <span class="nav-text">反编译ACPI文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#筛选ACPI文件"><span class="nav-number">6.</span> <span class="nav-text">筛选ACPI文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#修复错误"><span class="nav-number">7.</span> <span class="nav-text">修复错误</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#常用补丁"><span class="nav-number">8.</span> <span class="nav-text">常用补丁</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#关于一些特别的需求的修改"><span class="nav-number">9.</span> <span class="nav-text">关于一些特别的需求的修改</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#电池状态显示："><span class="nav-number">9.0.1.</span> <span class="nav-text">电池状态显示：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#屏幕亮度调节："><span class="nav-number">9.0.2.</span> <span class="nav-text">屏幕亮度调节：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#仿冒声卡驱动相关的补丁"><span class="nav-number">10.</span> <span class="nav-text">仿冒声卡驱动相关的补丁</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#让引导加载修改、编译好的文件"><span class="nav-number">11.</span> <span class="nav-text">让引导加载修改、编译好的文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Floating-regions"><span class="nav-number">12.</span> <span class="nav-text">Floating regions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#本教程用到的资源"><span class="nav-number">13.</span> <span class="nav-text">本教程用到的资源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#楼主总结"><span class="nav-number">14.</span> <span class="nav-text">楼主总结</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  © 2015 - 2017 <a href="http://www.miitbeian.gov.cn/">粤ICP备16125377号 </a> - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Nero Hau</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("KnPfHF2nqcEcD8STh9gned1Q-gzGzoHsz", "OWzEqIfokwLipVPXJ0sPrFBf");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

  

</body>
</html>
